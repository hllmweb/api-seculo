
<?php

define('user', 'SISWEB');
define('pass', '17Sec001!xx');
define('tns', '10.228.20.18/bdiseculo.seculomanaus.com.br');///bdiseculo.seculomanaus.com.br
define('encode', 'AL32UTF8');


$p_id        = $_GET['id'];
$p_encoding  = $_GET['encoding'];
// $p_id = '73661961268';
// $p_encoding = ', -0.10453729331493378, 0.08049996197223663, 0.004765969235450029, -0.04952184855937958, 0.04151361435651779, -0.07394012808799744, -0.028193706646561623, -0.09015533328056335, 0.19373288750648499, -0.05694524198770523, 0.0941423624753952, -0.002738115843385458, -0.14096850156784058, -0.13375069200992584, -0.01466582901775837, 0.1060418114066124, -0.23236216604709625, -0.11196784675121307, -0.08080092072486877, -0.16071467101573944, 0.0454331636428833, 0.023047586902976036, 0.024904606863856316, 0.0932617336511612, -0.20889723300933838, -0.2757118344306946, -0.11136133968830109, -0.11133784800767899, 0.0782024934887886, -0.07263346016407013, 0.05571868270635605, -0.02618594840168953, -0.22049792110919952, -0.09073834121227264, -0.033727437257766724, 0.0618625283241272, -0.0357610322535038, -0.056968554854393005, 0.1434371918439865, 0.03273196145892143, -0.09988134354352951, 0.0185079425573349, -0.001009443774819374, 0.28437113761901855, 0.16881072521209717, 0.0723503828048706, -0.03108537755906582, -0.008894253522157669, 0.16258195042610168, -0.20199702680110931, 0.04247347265481949, 0.1736135631799698, 0.02156989276409149, 0.08462588489055634, 0.1200731098651886, -0.09991538524627686, 0.05934757739305496, 0.15016773343086243, -0.21924030780792236, 0.05449375882744789, -0.036202818155288696, -0.005871772766113281, 0.059531643986701965, 0.01564197987318039, 0.08986316621303558, 0.07666730880737305, -0.05948935076594353, -0.08784773200750351, 0.1302037537097931, -0.1836441159248352, 0.03405924513936043, 0.00974136684089899, -0.032816141843795776, -0.1960732638835907, -0.2802838087081909, 0.055798716843128204, 0.3362731635570526, 0.18591976165771484, -0.1095132902264595, 0.06691942363977432, -0.04606937989592552, -0.04773430526256561, 0.13287994265556335, 0.02612496353685856, -0.10956861078739166, 0.02804819867014885, -0.07253977656364441, 0.0338655449450016, 0.1049608364701271, 0.06106393039226532, -0.030008571222424507, 0.23671738803386688, -0.019435487687587738, 0.0004741251468658447, 0.05303723365068436, 0.0038763503544032574, -0.18261374533176422, 0.0754055306315422, -0.07106802612543106, 0.024461250752210617, 0.10036744922399521, -0.04553161561489105, 0.05034559220075607, 0.05662474408745766, -0.09135527163743973, 0.160688117146492, 0.05697060376405716, 0.002045564353466034, -0.049985334277153015, 0.10392842441797256, -0.18199422955513, -0.07561121881008148, 0.13524137437343597, -0.21378810703754425, 0.20359279215335846, 0.19659574329853058, -0.06989579647779465, 0.16578084230422974, 0.07637658715248108, 0.071461021900177, -0.0328342542052269, 0.008232596330344677, -0.07072190195322037, -0.0507974810898304, 0.03954324126243591, -0.02544039487838745, 0.06687163561582565, 0.023776503279805183';


$conn   = oci_connect(user, pass, tns, encode);

if (!$conn) {
    echo "Erro na ConexÃ£o com o Banco";
    $m = oci_error();
    trigger_error(htmlentities($m['message']), E_USER_ERROR);
}

$sql    = 'BEGIN BD_APLICACAO.SP_ENCODING(:P_ID, :P_ENCODES, :RC1); END;'; 
$stid   = oci_parse($conn, $sql);
$cursor = oci_new_cursor($conn);

oci_bind_by_name($stid, ':P_ID',        $p_id);
oci_bind_by_name($stid, ':P_ENCODES',   $p_encoding);
oci_bind_by_name($stid, ':RC1', $cursor, -1, OCI_B_CURSOR);

oci_execute($stid);
oci_execute($cursor, OCI_DEFAULT);  


// echo $cursor;
// echo "<br><br>";

oci_fetch_all($cursor, $result, null, null, OCI_FETCHSTATEMENT_BY_ROW);
// echo '<br>dados';
echo json_encode($result);
// echo json_encode($result[0]['RETORNO']);


// $result = array();
// while (($row = oci_fetch_array($cursor, OCI_ASSOC+OCI_RETURN_NULLS)) != false) {   
//     array_push($result, array(
//         'NM_USUARIO' => $row['NM_USUARIO'],
//         'MENSAGEM'   => $row['MENSAGEM']
//     ));
// }

// echo json_encode($result);


oci_free_statement($stid);
oci_free_statement($cursor);
oci_close($conn);
?>